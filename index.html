<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Construction Connection Reusability Assessment</title>
    <style>
       <script>
/* ① tool data that was stuck inside <style> */
const toolProperties = {
  "Battery Disc Saw":  {setupTime:"Low",skillLevel:"Basic",       portability:"High"},
  "Corded Disc Saw":   {setupTime:"Low",skillLevel:"Basic",       portability:"Medium"},
  "Petrol Ring Saw":   {setupTime:"Low",skillLevel:"Intermediate",portability:"High"},
  "Corded Ring Saw":   {setupTime:"Low",skillLevel:"Intermediate",portability:"Medium"},
  "Petrol Chain Saw":  {setupTime:"Low",skillLevel:"Intermediate",portability:"High"},
  "Corded Chain Saw":  {setupTime:"Low",skillLevel:"Intermediate",portability:"Medium"},
  "Walk behind floor saw":{setupTime:"Low",skillLevel:"Intermediate",portability:"Medium"},
  "Automated Wall Saw":   {setupTime:"High",skillLevel:"Intermediate",portability:"Very Low"},
  "Hydro blast":          {setupTime:"High",skillLevel:"Advanced",  portability:"Low"},
  "Blow torch":           {setupTime:"Moderate",skillLevel:"Intermediate",portability:"High"},
  "Demolition Hammer":    {setupTime:"Low",skillLevel:"Basic",       portability:"Medium"},
  "Torque Wrench":        {setupTime:"Low",skillLevel:"Basic",       portability:"High"},
  "Angle Grinder":        {setupTime:"Low",skillLevel:"Basic",       portability:"High"},
  "Hydraulic Piston":     {setupTime:"Low",skillLevel:"Basic",       portability:"High"},
  "Welder":               {setupTime:"Moderate",skillLevel:"Intermediate",portability:"High"},
  "Diamond Drill":        {setupTime:"Low",skillLevel:"Basic",       portability:"High"},
  "Impact Wrench":        {setupTime:"Low",skillLevel:"Basic",       portability:"High"},
  "Rotary Hammer":        {setupTime:"Low",skillLevel:"Intermediate",portability:"High"}
};
const toolList = Object.keys(toolProperties);
let selectedTools = {};
const setupTimeScores = {Low:1,Moderate:0.5,High:0};
const skillLevelScores = {Basic:1,Intermediate:0.5,Advanced:0};
const portabilityScores = {High:1,Medium:0.66,Low:0.33,"Very Low":0};

/* ② build the grid */
function initializeToolSelection(){
  const grid = document.getElementById('toolSelectionGrid');
  if(!grid) return;
  grid.innerHTML = '';
  toolList.forEach(tool=>{
    const id = tool.replace(/\s+/g,'_').toLowerCase();
    grid.insertAdjacentHTML('beforeend',`
      <div class="tool-item" style="border:2px solid #ddd;border-radius:8px;padding:15px;background:#fff;cursor:pointer;transition:.3s;position:relative;">
        <div style="display:flex;align-items:center;margin-bottom:10px;">
          <input type="checkbox" id="tool_${id}" style="margin-right:10px;transform:scale(1.2);" />
          <label for="tool_${id}" style="font-weight:bold;cursor:pointer;flex:1;">${tool}</label>
        </div>
        <div style="font-size:.85em;color:#666;margin-bottom:10px;">
          Setup:${toolProperties[tool].setupTime} |
          Skill:${toolProperties[tool].skillLevel} |
          Portability:${toolProperties[tool].portability}
        </div>
        <div id="time_input_${id}" class="hidden"
             style="background:#f0f8ff;padding:10px;border-radius:5px;margin-top:10px;">
          <label style="display:block;font-size:.9em;margin-bottom:5px;">Time (minutes):</label>
          <input type="number" id="time_${id}" min="0" step="0.1"
                 style="width:100%;padding:5px;border:1px solid #ccc;border-radius:3px;">
        </div>
      </div>`);
    document.getElementById('tool_'+id)
            .addEventListener('change',()=>toggleTool(tool));
  });
}

/* ③ checkbox handler */
function toggleTool(tool){
  const id  = tool.replace(/\s+/g,'_').toLowerCase();
  const cb  = document.getElementById('tool_'+id);
  const box = document.getElementById('time_input_'+id);
  const card= cb.closest('.tool-item');

  if(cb.checked){
    selectedTools[tool]={time:0,properties:toolProperties[tool]};
    box.classList.remove('hidden');
    card.style.borderColor='#667eea';
    card.style.background='#f8f9ff';
    card.style.boxShadow='0 2px 8px rgba(102,126,234,.2)';
  }else{
    delete selectedTools[tool];
    box.classList.add('hidden');
    card.style.borderColor='#ddd';
    card.style.background='#fff';
    card.style.boxShadow='none';
    document.getElementById('time_'+id).value='';
  }

  if(typeof updateSelectedToolsDisplay==='function') updateSelectedToolsDisplay();
}
window.toggleTool = toggleTool;

        function updateSelectedToolsDisplay() {
            const propertiesDisplay = document.getElementById('toolPropertiesDisplay');
            const propertiesList = document.getElementById('toolPropertiesList');

            if (Object.keys(selectedTools).length > 0) {
                propertiesDisplay.style.display = 'block';
                let html = '<div><strong>Selected Tools:</strong></div>';
                
                Object.keys(selectedTools).forEach(tool => {
                    const properties = selectedTools[tool].properties;
                    html += `
                        <div style="margin: 10px 0; padding: 10px; background: rgba(102, 126, 234, 0.1); border-radius: 5px;">
                            <strong>${tool}</strong><br>
                            Setup: ${properties.setupTime} (${setupTimeScores[properties.setupTime]}) | 
                            Skill: ${properties.skillLevel} (${skillLevelScores[properties.skillLevel]}) | 
                            Portability: ${properties.portability} (${portabilityScores[properties.portability]})
                        </div>
                    `;
                });
                
                propertiesList.innerHTML = html;
            } else {
                propertiesDisplay.style.display = 'none';
            }
        }

        // Update the existing functions to work with multiple tools
        function updateToolDetails() {
            // This function is no longer needed for dropdown, but keeping for compatibility
        }

        function updateDisassemblyParameters() {
            const connectionType = document.getElementById('disassemblyConnectionType').value;
            const connectorsGroup = document.getElementById('connectorsGroup');
            const subParametersDisplay = document.getElementById('disassemblySubParameters');
            const subParametersList = document.getElementById('subParametersList');

            if (connectionType) {
                subParametersDisplay.style.display = 'block';
                
                if (connectionType === 'Cementitious') {
                    connectorsGroup.style.display = 'none';
                    subParametersList.innerHTML = `
                        <div><strong>Setup Time:</strong> Weight 0.22</div>
                        <div><strong>Skill Level:</strong> Weight 0.50</div>
                        <div><strong>Portability:</strong> Weight 0.28</div>
                        <div style="margin-top: 10px; color: #666; font-style: italic;">Formula: Σ(score × time) / Σ(time) for each parameter</div>
                    `;
                } else {
                    connectorsGroup.style.display = 'flex';
                    subParametersList.innerHTML = `
                        <div><strong>Setup Time:</strong> Weight 0.15</div>
                        <div><strong>Skill Level:</strong> Weight 0.48</div>
                        <div><strong>Portability:</strong> Weight 0.22</div>
                        <div><strong>Number of Connectors:</strong> Weight 0.15</div>
                        <div style="margin-top: 10px; color: #666; font-style: italic;">Formula: Σ(score × time) / Σ(time) for each parameter</div>
                    `;
                }
            } else {
                connectorsGroup.style.display = 'none';
                subParametersDisplay.style.display = 'none';
            }
        }

        function calculateEaseOfDisassembly() {
            try {
                const tool = document.getElementById('disassemblyTool').value;
                const toolTime = parseFloat(document.getElementById('toolTime').value) || 0;
                const connectionType = document.getElementById('disassemblyConnectionType').value;
                const numberOfConnectors = parseFloat(document.getElementById('numberOfConnectors').value) || 0;

                if (!tool || !connectionType || toolTime <= 0) {
                    document.getElementById('disassemblyResult').classList.add('hidden');
                    return;
                }

                const properties = toolProperties[tool];
                const setupTimeScore = setupTimeScores[properties.setupTime];
                const skillLevelScore = skillLevelScores[properties.skillLevel];
                const portabilityScore = portabilityScores[properties.portability];

                let score = 0;
                let details = '';

                if (connectionType === 'Cementitious') {
                    // Weights for cementitious: 0.22, 0.50, 0.28
                    score = (setupTimeScore * 0.22) + (skillLevelScore * 0.50) + (portabilityScore * 0.28);
                    
                    details = `
                        <div><strong>Calculation (Cementitious Connection):</strong></div>
                        <div>Score = (Setup Time × 0.22) + (Skill Level × 0.50) + (Portability × 0.28)</div>
                        <div>Score = (${setupTimeScore} × 0.22) + (${skillLevelScore} × 0.50) + (${portabilityScore} × 0.28)</div>
                        <div>Score = ${score.toFixed(4)}</div>
                        <div style="margin-top: 10px;">
                            <strong>Tool:</strong> ${tool}<br>
                            <strong>Time:</strong> ${toolTime} minutes<br>
                            <strong>Setup Time:</strong> ${properties.setupTime} (${setupTimeScore})<br>
                            <strong>Skill Level:</strong> ${properties.skillLevel} (${skillLevelScore})<br>
                            <strong>Portability:</strong> ${properties.portability} (${portabilityScore})
                        </div>
                    `;
                } else {
                    // Calculate connector score
                    let connectorScore = 1;
                    if (connectionType === 'Other') {
                        connectorScore = 1;
                    } else if (connectionType === 'Screw' || connectionType === 'Bolt') {
                        if (numberOfConnectors <= 2) {
                            connectorScore = 1;
                        } else if (numberOfConnectors === 3 || numberOfConnectors === 5) {
                            connectorScore = 0.95;
                        } else {
                            connectorScore = 0.9;
                        }
                    }

                    // Weights for screw/bolt/other: 0.15, 0.48, 0.22, 0.15
                    score = (setupTimeScore * 0.15) + (skillLevelScore * 0.48) + (portabilityScore * 0.22) + (connectorScore * 0.15);
                    
                    details = `
                        <div><strong>Calculation (${connectionType} Connection):</strong></div>
                        <div>Score = (Setup Time × 0.15) + (Skill Level × 0.48) + (Portability × 0.22) + (Connectors × 0.15)</div>
                        <div>Score = (${setupTimeScore} × 0.15) + (${skillLevelScore} × 0.48) + (${portabilityScore} × 0.22) + (${connectorScore} × 0.15)</div>
                        <div>Score = ${score.toFixed(4)}</div>
                        <div style="margin-top: 10px;">
                            <strong>Tool:</strong> ${tool}<br>
                            <strong>Time:</strong> ${toolTime} minutes<br>
                            <strong>Setup Time:</strong> ${properties.setupTime} (${setupTimeScore})<br>
                            <strong>Skill Level:</strong> ${properties.skillLevel} (${skillLevelScore})<br>
                            <strong>Portability:</strong> ${properties.portability} (${portabilityScore})<br>
                            <strong>Connectors:</strong> ${numberOfConnectors || 'N/A'} (${connectorScore})
                        </div>
                    `;
                }

                // Ensure score is between 0 and 1
                score = Math.max(0, Math.min(1, score));

                // Display results
                const resultDiv = document.getElementById('disassemblyResult');
                const scoreDiv = document.getElementById('disassemblyScore');
                const detailsDiv = document.getElementById('disassemblyDetails');

                resultDiv.classList.remove('hidden');
                scoreDiv.innerHTML = `Score: <span style="color: ${getRatingColor(score)}">${(score * 100).toFixed(1)}%</span>`;
                detailsDiv.innerHTML = details;

                // Scroll to results
                resultDiv.scrollIntoView({ behavior: 'smooth' });

            } catch (error) {
                console.error('Error calculating ease of disassembly:', error);
                document.getElementById('disassemblyResult').classList.add('hidden');
            }
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .nav-tabs {
            display: flex;
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            margin-bottom: 30px;
            backdrop-filter: blur(10px);
        }

        .nav-tab {
            flex: 1;
            padding: 15px;
            text-align: center;
            background: none;
            border: none;
            color: white;
            font-size: 1.1em;
            cursor: pointer;
            transition: all 0.3s ease;
            border-radius: 10px;
        }

        .nav-tab.active {
            background: rgba(255,255,255,0.2);
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .nav-tab:hover {
            background: rgba(255,255,255,0.15);
        }

        .content {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            backdrop-filter: blur(10px);
            min-height: 600px;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .form-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            background: #f9f9f9;
        }

        .form-section h3 {
            color: #667eea;
            margin-bottom: 15px;
            border-bottom: 2px solid #667eea;
            padding-bottom: 5px;
        }

        .form-group {
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .form-group label {
            min-width: 200px;
            font-weight: 500;
        }

        .form-group input, .form-group select {
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 1em;
            min-width: 150px;
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 5px rgba(102, 126, 234, 0.3);
        }

        .calculate-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 1.1em;
            border-radius: 8px;
            cursor: pointer;
            transition: transform 0.3s ease;
            margin: 20px 0;
        }

        .calculate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .results {
            margin-top: 30px;
            padding: 20px;
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            border-radius: 10px;
            color: white;
        }

        .score-display {
            font-size: 2em;
            font-weight: bold;
            text-align: center;
            margin: 20px 0;
        }

        .parameter-results {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .parameter-result {
            background: rgba(255,255,255,0.2);
            padding: 15px;
            border-radius: 8px;
        }

        .explanation-content {
            line-height: 1.8;
        }

        .explanation-content h2 {
            color: #667eea;
            margin: 30px 0 15px 0;
            border-left: 4px solid #667eea;
            padding-left: 15px;
        }

        .explanation-content h3 {
            color: #764ba2;
            margin: 20px 0 10px 0;
        }

        .formula {
            background: #f0f0f0;
            padding: 15px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            margin: 10px 0;
        }

        .table-container {
            overflow-x: auto;
            margin: 20px 0;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        th, td {
            padding: 12px;
            text-align: left;
            border: 1px solid #ddd;
        }

        th {
            background: #667eea;
            color: white;
        }

        .github-section {
            background: #f8f9fa;
            padding: 30px;
            border-radius: 10px;
            margin-top: 30px;
            border-left: 5px solid #667eea;
        }

        .github-steps {
            list-style: none;
            counter-reset: step-counter;
        }

        .github-steps li {
            counter-increment: step-counter;
            margin: 15px 0;
            padding: 15px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            position: relative;
            padding-left: 60px;
        }

        .github-steps li::before {
            content: counter(step-counter);
            position: absolute;
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
            background: #667eea;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        .code-block {
            background: #2d3748;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 8px;
            margin: 15px 0;
            overflow-x: auto;
            font-family: 'Courier New', monospace;
        }

        .hidden {
            display: none !important;
        }

        @media (max-width: 768px) {
            .form-group {
                flex-direction: column;
                align-items: flex-start;
            }

            .form-group label {
                min-width: auto;
            }

            .nav-tabs {
                flex-direction: column;
            }

            .container {
                padding: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🏗️ Construction Connection Reusability Assessment</h1>
            <p>Evaluate the reusability potential of construction connections with advanced scoring algorithms</p>
        </div>

        <div class="nav-tabs">
            <button class="nav-tab active" onclick="showTab('calculator')">📊 Calculator</button>
            <button class="nav-tab" onclick="showTab('explanation')">📚 Explanation</button>
            <button class="nav-tab" onclick="showTab('github')">🔗 GitHub Setup</button>
        </div>

        <div class="content">
            <!-- Calculator Tab -->
            <div id="calculator" class="tab-content active">
                <!-- Welcome Section -->
                <div class="welcome-section" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); color: white; padding: 30px; border-radius: 15px; margin-bottom: 30px; text-align: center;">
                    <h2>🏗️ Welcome to the Construction Connection Reusability Assessment</h2>
                    <p style="font-size: 1.1em; margin: 15px 0;">This advanced framework evaluates the reusability potential of construction connections through <strong>12 main parameters</strong>:</p>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 10px; margin: 20px 0; text-align: left;">
                        <div>• End of Cycle Waste</div>
                        <div>• Prefabrication Degree</div>
                        <div>• Damage Probability</div>
                        <div>• Ease of Disassembly</div>
                        <div>• Ease of Reassembly</div>
                        <div>• Connection Complexity</div>
                        <div>• Number of Steps and Time</div>
                        <div>• Accessibility of Connection</div>
                        <div>• Tolerance</div>
                        <div>• Size</div>
                        <div>• Structural Strength</div>
                        <div>• Design Documentation</div>
                    </div>
                    <p style="font-size: 1.1em;">Based on these parameters, the reusability score of your connection will be calculated to help optimize construction sustainability.</p>
                </div>

                <form id="assessmentForm">
                    <!-- 1. End of Cycle Waste -->
                    <div class="form-section">
                        <h3>🔄 1. End of Cycle Waste Assessment</h3>
                        <p style="margin-bottom: 20px; color: #666; font-style: italic;">This parameter assesses the amount of material that can be reused when the connection system is disassembled.</p>
                        
                        <!-- Connection Geometry -->
                        <div style="background: #f0f8ff; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                            <h4 style="color: #667eea; margin-bottom: 15px;">📐 Connection Geometry</h4>
                            <div class="form-group">
                                <label for="connectionType">Connection Type:</label>
                                <select id="connectionType" required onchange="updateJointArea()">
                                    <option value="">Select Connection Type</option>
                                    <option value="Column-Column">Column-Column</option>
                                    <option value="Wall-Wall Horizontal">Wall-Wall Horizontal</option>
                                    <option value="Other">Other Connections</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="length">Length (cm):</label>
                                <input type="number" id="length" min="0" step="0.1" required onchange="updateJointArea()">
                            </div>
                            <div class="form-group">
                                <label for="width">Width (cm):</label>
                                <input type="number" id="width" min="0" step="0.1" required onchange="updateJointArea()">
                            </div>
                            <div class="form-group">
                                <label for="height">Height (cm):</label>
                                <input type="number" id="height" min="0" step="0.1" onchange="updateJointArea()">
                            </div>
                            <div class="form-group" style="background: #e8f5e8; padding: 10px; border-radius: 5px; margin-top: 15px;">
                                <label style="font-weight: bold; color: #2e7d32;">Joint Area:</label>
                                <span id="jointAreaDisplay" style="font-weight: bold; color: #2e7d32;">-- cm²</span>
                            </div>
                        </div>

                        <!-- Material Properties -->
                        <div style="background: #fff8e1; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                            <h4 style="color: #f57c00; margin-bottom: 15px;">🧱 Material Properties</h4>
                            <div class="form-group">
                                <label for="wasteArea">Waste Area (cm²):</label>
                                <input type="number" id="wasteArea" min="0" step="0.1" required>
                            </div>
                            <div class="form-group">
                                <label for="strengthClass">Concrete Strength Class:</label>
                                <select id="strengthClass" required onchange="updateReductionFactor()">
                                    <option value="">Select Strength Class</option>
                                    <option value="C12/15">C12/15</option>
                                    <option value="C20/25">C20/25</option>
                                    <option value="C30/37">C30/37</option>
                                    <option value="C40/50">C40/50</option>
                                    <option value="C45/55">C45/55</option>
                                    <option value="C50/60">C50/60</option>
                                    <option value="C55/67">C55/67</option>
                                    <option value="C60/76">C60/76</option>
                                    <option value="C70/85">C70/85</option>
                                    <option value="C80/95">C80/95</option>
                                    <option value="C90/105">C90/105</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="mortarType">Mortar Type:</label>
                                <select id="mortarType" required onchange="updateReductionFactor()">
                                    <option value="">Select Mortar Type</option>
                                    <option value="I">Type I</option>
                                    <option value="IIIA">Type IIIA</option>
                                    <option value="IIIB">Type IIIB</option>
                                    <option value="IIIC">Type IIIC</option>
                                </select>
                            </div>
                            <div class="form-group" style="background: #e8f5e8; padding: 10px; border-radius: 5px; margin-top: 15px;">
                                <label style="font-weight: bold; color: #2e7d32;">Mortar Reduction Factor:</label>
                                <span id="reductionFactorDisplay" style="font-weight: bold; color: #2e7d32;">--</span>
                            </div>
                        </div>

                        <!-- Reinforcement Properties -->
                        <div style="background: #fce4ec; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                            <h4 style="color: #c2185b; margin-bottom: 15px;">🔩 Reinforcement Properties</h4>
                            <div class="form-group" style="background: #e1f5fe; padding: 10px; border-radius: 5px; margin-bottom: 15px;">
                                <label style="font-weight: bold; color: #0277bd;">Reinforcement Type:</label>
                                <span id="reinforcementTypeDisplay" style="font-weight: bold; color: #0277bd;">--</span>
                            </div>
                            <div class="form-group">
                                <label for="reinforcementValue" id="reinforcementLabel">Reinforcement:</label>
                                <input type="text" id="reinforcementValue" placeholder="Enter 'No waste' or number/length">
                            </div>
                            <div class="form-group" id="reinforcementLengthGroup" style="display: none;">
                                <label for="reinforcementLength">Reinforcement Length (cm):</label>
                                <input type="number" id="reinforcementLength" min="0" step="0.1" placeholder="Enter length in cm (e.g., 70)">
                            </div>
                            <div class="form-group">
                                <label for="reinforcementDiameter">Reinforcement Diameter:</label>
                                <select id="reinforcementDiameter">
                                    <option value="8">8 mm</option>
                                    <option value="12">12 mm</option>
                                    <option value="16">16 mm</option>
                                    <option value="20">20 mm</option>
                                    <option value="25">25 mm</option>
                                    <option value="32">32 mm</option>
                                    <option value="40">40 mm</option>
                                </select>
                            </div>
                        </div>

                        <!-- Calculate Button and Result -->
                        <div style="text-align: center; margin: 20px 0;">
                            <button type="button" class="calculate-btn" onclick="calculateEndOfCycleWaste()">
                                🔬 Calculate End of Cycle Waste Score
                            </button>
                        </div>

                        <div id="endOfCycleResult" class="results hidden">
                            <h4>📊 End of Cycle Waste Result</h4>
                            <div class="score-display" id="endOfCycleScore" style="font-size: 1.5em;">Score: --</div>
                            <div id="endOfCycleDetails" style="margin-top: 15px; font-size: 0.9em;"></div>
                        </div>
                    </div>

                    <!-- Placeholder for next parameter -->
                    <div class="form-section" style="background: #f5f5f5; border: 2px dashed #ccc; text-align: center; padding: 40px;">
                        <h3 style="color: #999;">📋 Next Parameter: Prefabrication Degree</h3>
                        <p style="color: #666;">This section will be added after completing the End of Cycle Waste assessment</p>
                    </div>

                    <!-- 2. Prefabrication Degree -->
                    <div class="form-section">
                        <h3>🏭 2. Prefabrication Degree Assessment</h3>
                        <p style="margin-bottom: 20px; color: #666; font-style: italic;">This parameter measures the extent to which the connection is produced in a factory.</p>
                        
                        <div style="background: #f0f8ff; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                            <h4 style="color: #667eea; margin-bottom: 15px;">🏗️ Prefabrication Details</h4>
                            <div class="form-group">
                                <label for="prefabricatedArea">Prefabricated Area (cm²):</label>
                                <input type="number" id="prefabricatedArea" min="0" step="0.1" required>
                            </div>
                            <div class="form-group" style="background: #e8f5e8; padding: 10px; border-radius: 5px; margin-top: 15px;">
                                <label style="font-weight: bold; color: #2e7d32;">Joint Area (from above):</label>
                                <span id="jointAreaDisplay2" style="font-weight: bold; color: #2e7d32;">-- cm²</span>
                            </div>
                        </div>

                        <!-- Calculate Button and Result -->
                        <div style="text-align: center; margin: 20px 0;">
                            <button type="button" class="calculate-btn" onclick="calculatePrefabricationDegree()">
                                🔬 Calculate Prefabrication Degree Score
                            </button>
                        </div>

                        <div id="prefabricationResult" class="results hidden">
                            <h4>📊 Prefabrication Degree Result</h4>
                            <div class="score-display" id="prefabricationScore" style="font-size: 1.5em;">Score: --</div>
                            <div id="prefabricationDetails" style="margin-top: 15px; font-size: 0.9em;"></div>
                        </div>
                    </div>

                    <!-- Placeholder for next parameter -->
                    <div class="form-section" style="background: #f5f5f5; border: 2px dashed #ccc; text-align: center; padding: 40px;">
                        <h3 style="color: #999;">📋 Next Parameter: Damage Probability</h3>
                        <p style="color: #666;">This section will be added after completing the Prefabrication Degree assessment</p>
                    </div>

                    <!-- 3. Ease of Disassembly -->
                    <div class="form-section">
                        <h3>🔧 3. Ease of Disassembly Assessment</h3>
                        <p style="margin-bottom: 20px; color: #666; font-style: italic;">This parameter quantifies all procedures required to disassemble the connection system, encompassing the necessary tools, required labor skill level, and setup time.</p>
                        
                        <!-- Tool Selection -->
                        <div style="background: #fff8e1; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                            <h4 style="color: #f57c00; margin-bottom: 15px;">🛠️ Tool Selection (Select Multiple)</h4>
                            <p style="margin-bottom: 15px; color: #666; font-size: 0.9em;">Click on the tools you will use for disassembly. Time input will appear for each selected tool.</p>
                            
                            <div id="toolSelectionGrid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 15px;">
                                <!-- Tool items will be dynamically generated -->
                            </div>
                        </div>

                        <!-- Connection Type -->
                        <div style="background: #f3e5f5; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                            <h4 style="color: #8e24aa; margin-bottom: 15px;">🔗 Connection Type</h4>
                            <div class="form-group">
                                <label for="disassemblyConnectionType">Connection Type:</label>
                                <select id="disassemblyConnectionType" onchange="updateDisassemblyParameters()" required>
                                    <option value="">Select connection type</option>
                                    <option value="Cementitious">Cementitious</option>
                                    <option value="Screw">Screw</option>
                                    <option value="Bolt">Bolt</option>
                                    <option value="Other">Other</option>
                                </select>
                            </div>
                            <div class="form-group" id="connectorsGroup" style="display: none;">
                                <label for="numberOfConnectors">Number of Connectors:</label>
                                <input type="number" id="numberOfConnectors" min="1" step="1" placeholder="Enter number of connectors">
                            </div>
                        </div>

                        <!-- Sub-parameters Display -->
                        <div id="disassemblySubParameters" style="background: #e8f5e8; padding: 15px; border-radius: 8px; margin-bottom: 20px; display: none;">
                            <h4 style="color: #2e7d32; margin-bottom: 15px;">📊 Sub-parameters and Weights</h4>
                            <div id="subParametersList"></div>
                        </div>

                        <!-- Tool Properties Display -->
                        <div id="toolPropertiesDisplay" style="background: #e1f5fe; padding: 15px; border-radius: 8px; margin-bottom: 20px; display: none;">
                            <h4 style="color: #0277bd; margin-bottom: 15px;">🔍 Tool Properties</h4>
                            <div id="toolPropertiesList"></div>
                        </div>

                        <!-- Calculate Button and Result -->
                        <div style="text-align: center; margin: 20px 0;">
                            <button type="button" class="calculate-btn" onclick="calculateEaseOfDisassembly()">
                                🔬 Calculate Ease of Disassembly Score
                            </button>
                        </div>

                        <div id="disassemblyResult" class="results hidden">
                            <h4>📊 Ease of Disassembly Result</h4>
                            <div class="score-display" id="disassemblyScore" style="font-size: 1.5em;">Score: --</div>
                            <div id="disassemblyDetails" style="margin-top: 15px; font-size: 0.9em;"></div>
                        </div>
                    </div>

                    <!-- Placeholder for next parameter -->
                    <div class="form-section" style="background: #f5f5f5; border: 2px dashed #ccc; text-align: center; padding: 40px;">
                        <h3 style="color: #999;">📋 Next Parameter: Ease of Reassembly</h3>
                        <p style="color: #666;">This section will be added after completing the Ease of Disassembly assessment</p>
                    </div>
                </form>

                <div id="results" class="results hidden">
                    <h3>📊 Assessment Results</h3>
                    <div class="score-display" id="totalScore">Overall Score: --</div>
                    <div class="parameter-results" id="parameterResults"></div>
                </div>
            </div>

            <!-- Explanation Tab -->
            <div id="explanation" class="tab-content">
                <div class="explanation-content">
                    <h2>📚 Reusability Assessment Framework</h2>
                    
                    <p>This framework evaluates the reusability potential of construction connections through a comprehensive multi-parameter assessment system. The methodology considers technical, practical, and economic factors that influence the feasibility of connection disassembly and reassembly.</p>

                    <h2>🎯 Main Parameters</h2>

                    <h3>1. End of Cycle Waste (Weight: 2.40)</h3>
                    <p>Assesses the amount of material that can be reused when the connection system is disassembled. The score is calculated using:</p>
                    <div class="formula">
                        Score = (Reusable Area / Joint Area) × (1 / RF_material)
                    </div>
                    <p>Where RF_material is the reduction factor based on concrete strength class and mortar type.</p>

                    <h3>2. Damage Probability (Weight: 2.65)</h3>
                    <p>Evaluates the probability of damaging connection components during disassembly and reassembly operations, considering:</p>
                    <ul>
                        <li><strong>Minor Damage Probability (28%)</strong>: Easily repairable damage</li>
                        <li><strong>Major Damage Probability (52%)</strong>: Damage requiring additional measurements</li>
                        <li><strong>Precision (20%)</strong>: Tool precision requirements</li>
                    </ul>

                    <h3>3. Ease of Disassembly (Weight: 3.06)</h3>
                    <p>Quantifies procedures required to disassemble the connection system, including:</p>
                    <ul>
                        <li><strong>Setup Time (22%)</strong>: Time to prepare tools and safety measures</li>
                        <li><strong>Skill Level (50%)</strong>: Required operator training level</li>
                        <li><strong>Portability (28%)</strong>: Tool transportation and mobility</li>
                    </ul>

                    <h3>4. Ease of Reassembly (Weight: 2.70)</h3>
                    <p>Uses the same sub-parameters as disassembly but considers different tools and processes for reassembly operations.</p>

                    <h3>5. Connection Complexity (Weight: 2.80)</h3>
                    <p>Evaluates complexity during construction and deconstruction phases:</p>
                    <ul>
                        <li><strong>Connection Type (10%)</strong>: Force transfer mechanism</li>
                        <li><strong>Industry Preference (30%)</strong>: Familiarity within Netherlands construction industry</li>
                        <li><strong>Skill Level (30%)</strong>: Required expertise</li>
                        <li><strong>Time (30%)</strong>: Total process duration</li>
                    </ul>

                    <h3>6. Additional Parameters</h3>
                    <ul>
                        <li><strong>Design Documentation (3.68)</strong>: Availability of structural drawings and calculations</li>
                        <li><strong>Number of Steps and Time (2.41)</strong>: Process complexity and duration</li>
                        <li><strong>Accessibility of Connection (1.50)</strong>: Worker access during operations</li>
                        <li><strong>Tolerance (1.49)</strong>: Dimensional precision requirements</li>
                        <li><strong>Prefabrication Degree (1.26)</strong>: Extent of factory production</li>
                        <li><strong>Size (1.06)</strong>: Joint area considerations</li>
                        <li><strong>Structural Strength (1.00)</strong>: Connection load capacity</li>
                    </ul>

                    <h2>📈 Scoring System</h2>
                    <p>Each parameter is scored on a scale from 0 to 1, where:</p>
                    <ul>
                        <li><strong>1.0</strong>: Excellent reusability potential</li>
                        <li><strong>0.75-0.99</strong>: Good reusability potential</li>
                        <li><strong>0.5-0.74</strong>: Moderate reusability potential</li>
                        <li><strong>0.25-0.49</strong>: Poor reusability potential</li>
                        <li><strong>0.0-0.24</strong>: Very poor reusability potential</li>
                    </ul>

                    <p>The final score is calculated as a weighted average of all parameters, providing a comprehensive assessment of connection reusability.</p>

                    <h2>🔬 Mathematical Formulations</h2>
                    <p>The framework employs various mathematical models:</p>
                    
                    <h3>Damage Probability Calculations</h3>
                    <div class="formula">
                        P(t) = 1 - e^(-λt)
                        P_score = ∏(1 - p_i)
                    </div>

                    <h3>Time Scoring Function</h3>
                    <div class="formula">
                        f(t) = {
                            1               if t ≤ 120
                            2 - t/120       if 120 < t ≤ 240
                            0               if t > 240
                        }
                    </div>

                    <h3>Tolerance Scoring</h3>
                    <div class="formula">
                        f(t) = {
                            0               if t < 10 mm
                            (t-10)/40       if 10 ≤ t ≤ 50 mm
                            1               if t > 50 mm
                        }
                    </div>
                </div>
            </div>

            <!-- GitHub Setup Tab -->
            <div id="github" class="tab-content">
                <div class="github-section">
                    <h2>🚀 Deploy to GitHub Pages</h2>
                    <p>Follow these steps to deploy this calculator to your GitHub account and make it accessible online:</p>

                    <ol class="github-steps">
                        <li>
                            <strong>Create a GitHub Account</strong>
                            <p>If you don't have one, sign up at <a href="https://github.com" target="_blank">github.com</a></p>
                        </li>

                        <li>
                            <strong>Create a New Repository</strong>
                            <ul>
                                <li>Click the "+" icon in the top right corner</li>
                                <li>Select "New repository"</li>
                                <li>Name it: <code>reusability-calculator</code></li>
                                <li>Make it public</li>
                                <li>Check "Add a README file"</li>
                                <li>Click "Create repository"</li>
                            </ul>
                        </li>

                        <li>
                            <strong>Upload Your Files</strong>
                            <p>Copy this HTML code and save it as <code>index.html</code>:</p>
                            <div class="code-block">
&lt;!-- Copy the entire HTML source of this page --&gt;
&lt;!-- You can right-click → View Page Source to get the full code --&gt;
                            </div>
                            <p>Then upload it to your repository by clicking "Add file" → "Upload files"</p>
                        </li>

                        <li>
                            <strong>Enable GitHub Pages</strong>
                            <ul>
                                <li>Go to your repository settings</li>
                                <li>Scroll down to "Pages" section</li>
                                <li>Under "Source", select "Deploy from a branch"</li>
                                <li>Choose "main" branch and "/ (root)" folder</li>
                                <li>Click "Save"</li>
                            </ul>
                        </li>

                        <li>
                            <strong>Access Your Live Calculator</strong>
                            <p>After a few minutes, your calculator will be available at:</p>
                            <div class="code-block">
https://yourusername.github.io/reusability-calculator
                            </div>
                            <p>Replace "yourusername" with your actual GitHub username</p>
                        </li>

                        <li>
                            <strong>Optional: Custom Domain</strong>
                            <p>You can add a custom domain by:</p>
                            <ul>
                                <li>Adding a CNAME file to your repository</li>
                                <li>Configuring DNS settings with your domain provider</li>
                                <li>Setting up the custom domain in GitHub Pages settings</li>
                            </ul>
                        </li>
                    </ol>

                    <div style="background: #e3f2fd; padding: 20px; border-radius: 8px; margin: 20px 0;">
                        <h3>💡 Pro Tips:</h3>
                        <ul>
                            <li>Use descriptive commit messages when updating your code</li>
                            <li>Enable branch protection rules for production deployments</li>
                            <li>Consider using GitHub Actions for automated testing</li>
                            <li>Add a detailed README.md file to document your project</li>
                        </ul>
                    </div>

                    <div style="background: #fff3e0; padding: 20px; border-radius: 8px; margin: 20px 0;">
                        <h3>📂 Recommended Repository Structure:</h3>
                        <div class="code-block">
reusability-calculator/
├── index.html          (This calculator)
├── README.md           (Project documentation)
├── css/
│   └── styles.css      (Optional: External CSS)
├── js/
│   └── calculator.js   (Optional: External JavaScript)
└── docs/
    └── methodology.pdf (Optional: Technical documentation)
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Material reduction factors from the documentation
        const reductionFactors = {
            'C12/15': { 'I': 1.82, 'IIIA': 2.03, 'IIIB': 2.29, 'IIIC': 2.50 },
            'C20/25': { 'I': 1.69, 'IIIA': 1.98, 'IIIB': 2.23, 'IIIC': 2.44 },
            'C30/37': { 'I': 1.57, 'IIIA': 1.85, 'IIIB': 2.09, 'IIIC': 2.30 },
            'C40/50': { 'I': 1.46, 'IIIA': 1.74, 'IIIB': 1.96, 'IIIC': null },
            'C45/55': { 'I': 1.44, 'IIIA': 1.70, 'IIIB': 1.90, 'IIIC': 2.10 },
            'C50/60': { 'I': 1.28, 'IIIA': 1.53, 'IIIB': 1.75, 'IIIC': null },
            'C55/67': { 'I': 1.38, 'IIIA': 1.58, 'IIIB': 1.60, 'IIIC': null },
            'C60/76': { 'I': 1.29, 'IIIA': 1.52, 'IIIB': 1.64, 'IIIC': null },
            'C70/85': { 'I': 1.10, 'IIIA': 1.27, 'IIIB': 1.37, 'IIIC': null },
            'C80/95': { 'I': 1.04, 'IIIA': 1.15, 'IIIB': 1.08, 'IIIC': null },
            'C90/105': { 'I': 1.04, 'IIIA': 1.08, 'IIIB': 1.04, 'IIIC': null }
        };

        // Parameter weights from the documentation
        const weights = {
            endOfCycleWaste: 2.40,
            damageProb: 2.65,
            easeDisassembly: 3.06,
            easeReassembly: 2.70,
            connectionComplexity: 2.80,
            designDoc: 3.68,
            stepsAndTime: 2.41,
            accessibility: 1.50,
            tolerance: 1.49,
            prefabDegree: 1.26,
            size: 1.06,
            structuralStrength: 1.00
        };

        function showTab(tabName) {
            // Hide all tab contents
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Remove active class from all nav tabs
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected tab
            document.getElementById(tabName).classList.add('active');
            
            // Add active class to clicked nav tab
            event.target.classList.add('active');
        }

        // Constants
        const REINFORCEMENT_REDUCTION_FACTOR = 0.2; // Updated to 0.2 as specified

        function updateJointArea() {
            try {
                const connectionType = document.getElementById('connectionType').value;
                const length = parseFloat(document.getElementById('length').value) || 0;
                const width = parseFloat(document.getElementById('width').value) || 0;
                const height = parseFloat(document.getElementById('height').value) || 0;

                let jointArea = 0;
                let reinforcementType = '';

                if (connectionType === 'Wall-Wall Horizontal') {
                    jointArea = length * width;
                    reinforcementType = 'Number of Reinforcement';
                } else if (connectionType === 'Column-Column') {
                    jointArea = Math.min(length, width) * height;
                    reinforcementType = 'Number of Reinforcement';
                } else if (connectionType === 'Other') {
                    jointArea = Math.min(length, width) * height;
                    reinforcementType = 'Number + Length';
                }

                // Update displays (silently handle errors)
                const jointAreaDisplay = document.getElementById('jointAreaDisplay');
                const jointAreaDisplay2 = document.getElementById('jointAreaDisplay2');
                const reinforcementTypeDisplay = document.getElementById('reinforcementTypeDisplay');
                const reinforcementLengthGroup = document.getElementById('reinforcementLengthGroup');
                
                if (jointAreaDisplay) {
                    jointAreaDisplay.textContent = jointArea > 0 ? `${jointArea.toFixed(2)} cm²` : '-- cm²';
                }
                
                if (jointAreaDisplay2) {
                    jointAreaDisplay2.textContent = jointArea > 0 ? `${jointArea.toFixed(2)} cm²` : '-- cm²';
                }
                
                if (reinforcementTypeDisplay) {
                    reinforcementTypeDisplay.textContent = reinforcementType || '--';
                }

                // Show/hide reinforcement length input based on connection type
                if (reinforcementLengthGroup) {
                    if (connectionType === 'Other') {
                        reinforcementLengthGroup.style.display = 'flex';
                    } else {
                        reinforcementLengthGroup.style.display = 'none';
                    }
                }

                // Update reinforcement label and input type
                const reinforcementLabel = document.getElementById('reinforcementLabel');
                const reinforcementInput = document.getElementById('reinforcementValue');
                
                if (reinforcementLabel && reinforcementInput) {
                    if (connectionType === 'Column-Column' || connectionType === 'Wall-Wall Horizontal') {
                        reinforcementLabel.textContent = 'Number of Reinforcement:';
                        reinforcementInput.placeholder = "Enter 'No waste' or number (e.g., 4)";
                    } else if (connectionType === 'Other') {
                        reinforcementLabel.textContent = 'Number of Reinforcement:';
                        reinforcementInput.placeholder = "Enter 'No waste' or number (e.g., 2)";
                    } else {
                        reinforcementLabel.textContent = 'Reinforcement:';
                        reinforcementInput.placeholder = '';
                    }
                }
            } catch (error) {
                // Silent error handling - don't show errors to user
                console.log('Joint area calculation error (silenced):', error);
            }
        }

        function updateReductionFactor() {
            try {
                const strengthClass = document.getElementById('strengthClass').value;
                const mortarType = document.getElementById('mortarType').value;
                const reductionFactorDisplay = document.getElementById('reductionFactorDisplay');

                if (!strengthClass || !mortarType || !reductionFactorDisplay) return;

                const factor = reductionFactors[strengthClass]?.[mortarType];
                reductionFactorDisplay.textContent = factor ? factor.toString() : '--';
            } catch (error) {
                console.log('Reduction factor update error (silenced):', error);
            }
        }

        function calculateEndOfCycleWaste() {
            try {
                const connectionType = document.getElementById('connectionType').value;
                const length = parseFloat(document.getElementById('length').value) || 0;
                const width = parseFloat(document.getElementById('width').value) || 0;
                const height = parseFloat(document.getElementById('height').value) || 0;
                const wasteArea = parseFloat(document.getElementById('wasteArea').value) || 0;
                const reinforcementValue = document.getElementById('reinforcementValue').value.trim();
                const reinforcementLength = parseFloat(document.getElementById('reinforcementLength').value) || 0;
                const reinforcementDiameter = parseFloat(document.getElementById('reinforcementDiameter').value) || 0;
                const strengthClass = document.getElementById('strengthClass').value;
                const mortarType = document.getElementById('mortarType').value;

                // Calculate joint area in cm²
                let jointArea = 0;
                if (connectionType === 'Wall-Wall Horizontal') {
                    jointArea = length * width;
                } else if (connectionType === 'Column-Column' || connectionType === 'Other') {
                    jointArea = Math.min(length, width) * height;
                }

                // Get reduction factor
                const reductionFactor = reductionFactors[strengthClass]?.[mortarType];

                // Check if we have all required values
                if (!jointArea || !reductionFactor || jointArea <= 0 || reductionFactor <= 0) {
                    document.getElementById('endOfCycleResult').classList.add('hidden');
                    return;
                }

                let score = 0;
                let details = '';

                if (reinforcementValue.toLowerCase() === 'no waste') {
                    // No reinforcement waste - calculate without reinforcement area
                    score = 1 - (wasteArea / jointArea / reductionFactor);
                    details = `
                        <div><strong>Calculation (No Reinforcement Waste):</strong></div>
                        <div>Score = 1 - (Waste Area / Joint Area / Reduction Factor)</div>
                        <div>Score = 1 - (${wasteArea} / ${jointArea.toFixed(2)} / ${reductionFactor})</div>
                        <div>Score = ${score.toFixed(4)}</div>
                        <div style="margin-top: 10px;"><em>No reinforcement waste considered</em></div>
                    `;
                } else {
                    // Calculate with reinforcement area using different logic based on connection type
                    const reinforcementNum = parseFloat(reinforcementValue);
                    
                    if (isNaN(reinforcementNum) || reinforcementNum <= 0) {
                        document.getElementById('endOfCycleResult').classList.add('hidden');
                        return;
                    }

                    let reinforcementArea = 0;
                    let calculationDetails = '';

                    if (connectionType === 'Column-Column' || connectionType === 'Wall-Wall Horizontal') {
                        // Formula: (diameter² × π / 4) × number / 0.2
                        reinforcementArea = (Math.pow(reinforcementDiameter, 2) * Math.PI / 4) * reinforcementNum / REINFORCEMENT_REDUCTION_FACTOR;
                        calculationDetails = `(${reinforcementDiameter}² × π / 4) × ${reinforcementNum} / ${REINFORCEMENT_REDUCTION_FACTOR}`;
                    } else {
                        // Formula for Other connections: reinforcement_length × diameter × number / 0.2
                        if (!reinforcementLength || reinforcementLength <= 0) {
                            document.getElementById('endOfCycleResult').classList.add('hidden');
                            return;
                        }
                        reinforcementArea = reinforcementLength * 10 * reinforcementDiameter * reinforcementNum / REINFORCEMENT_REDUCTION_FACTOR; // convert cm to mm
                        calculationDetails = `${reinforcementLength * 10} × ${reinforcementDiameter} × ${reinforcementNum} / ${REINFORCEMENT_REDUCTION_FACTOR}`;
                    }

                    const reinforcementAreaCm2 = reinforcementArea / 100; // Convert mm² to cm²

                    score = 1 - (wasteArea / jointArea / reductionFactor) - (reinforcementAreaCm2 / jointArea);
                    
                    details = `
                        <div><strong>Calculation with Reinforcement (${connectionType}):</strong></div>
                        <div>Score = 1 - (Waste Area / Joint Area / Reduction Factor) - (Reinforcement Area / Joint Area)</div>
                        <div>Reinforcement Area = ${calculationDetails}</div>
                        <div>Reinforcement Area = ${reinforcementAreaCm2.toFixed(4)} cm²</div>
                        <div>Score = 1 - (${wasteArea} / ${jointArea.toFixed(2)} / ${reductionFactor}) - (${reinforcementAreaCm2.toFixed(4)} / ${jointArea.toFixed(2)})</div>
                        <div>Score = ${score.toFixed(4)}</div>
                        <div style="margin-top: 10px;"><em>Connection type: ${connectionType}</em></div>
                    `;
                }

                // Ensure score is between 0 and 1
                score = Math.max(0, Math.min(1, score));

                // Display results
                const resultDiv = document.getElementById('endOfCycleResult');
                const scoreDiv = document.getElementById('endOfCycleScore');
                const detailsDiv = document.getElementById('endOfCycleDetails');

                resultDiv.classList.remove('hidden');
                scoreDiv.innerHTML = `Score: <span style="color: ${getRatingColor(score)}">${(score * 100).toFixed(1)}%</span>`;
                detailsDiv.innerHTML = details;

                // Scroll to results
                resultDiv.scrollIntoView({ behavior: 'smooth' });

            } catch (error) {
                console.error('Error calculating end of cycle waste:', error);
                document.getElementById('endOfCycleResult').classList.add('hidden');
            }
        }

        function calculatePrefabricationDegree() {
            try {
                const connectionType = document.getElementById('connectionType').value;
                const length = parseFloat(document.getElementById('length').value) || 0;
                const width = parseFloat(document.getElementById('width').value) || 0;
                const height = parseFloat(document.getElementById('height').value) || 0;
                const prefabricatedArea = parseFloat(document.getElementById('prefabricatedArea').value) || 0;

                // Calculate joint area in cm²
                let jointArea = 0;
                if (connectionType === 'Wall-Wall Horizontal') {
                    jointArea = length * width;
                } else if (connectionType === 'Column-Column' || connectionType === 'Other') {
                    jointArea = Math.min(length, width) * height;
                }

                // Check if we have all required values
                if (!jointArea || jointArea <= 0) {
                    document.getElementById('prefabricationResult').classList.add('hidden');
                    return;
                }

                // Calculate prefabrication degree score
                const score = Math.min(1, prefabricatedArea / jointArea);
                
                const details = `
                    <div><strong>Calculation:</strong></div>
                    <div>Prefabrication Degree Score = Prefabricated Area / Joint Area</div>
                    <div>Score = ${prefabricatedArea} / ${jointArea.toFixed(2)}</div>
                    <div>Score = ${score.toFixed(4)}</div>
                    <div style="margin-top: 10px;"><em>Score is capped at 1.0 (100%)</em></div>
                `;

                // Display results
                const resultDiv = document.getElementById('prefabricationResult');
                const scoreDiv = document.getElementById('prefabricationScore');
                const detailsDiv = document.getElementById('prefabricationDetails');

                resultDiv.classList.remove('hidden');
                scoreDiv.innerHTML = `Score: <span style="color: ${getRatingColor(score)}">${(score * 100).toFixed(1)}%</span>`;
                detailsDiv.innerHTML = details;

                // Scroll to results
                resultDiv.scrollIntoView({ behavior: 'smooth' });

            } catch (error) {
                console.error('Error calculating prefabrication degree:', error);
                document.getElementById('prefabricationResult').classList.add('hidden');
            }
        }

        function calculateDamageProb() {
            const damageLevel = document.getElementById('damageLevel').value;
            
            const damageParams = {
                'low': { minor: 0.2, major: 0.1, precision: 0.9 },
                'moderate': { minor: 0.4, major: 0.2, precision: 0.6 },
                'high': { minor: 0.6, major: 0.3, precision: 0.3 },
                'very-high': { minor: 0.8, major: 0.3, precision: 0.3 }
            };

            if (!damageParams[damageLevel]) return 0;

            const params = damageParams[damageLevel];
            
            // Calculate damage probabilities (simplified version)
            const minorDamage = 1 - params.minor;
            const majorDamage = 1 - params.major;
            const precision = params.precision;

            // Weighted combination
            return (minorDamage * 0.28) + (majorDamage * 0.52) + (precision * 0.20);
        }

        function calculateEaseScore() {
            const setupTime = document.getElementById('setupTime').value;
            const skillLevel = document.getElementById('skillLevel').value;
            const portability = document.getElementById('portability').value;

            const setupScores = { 'low': 1, 'medium': 0.5, 'high': 0 };
            const skillScores = { 'basic': 1, 'intermediate': 0.5, 'advanced': 0 };
            const portabilityScores = { 'high': 1, 'medium': 0.66, 'low': 0.33, 'very-low': 0 };

            if (!setupTime || !skillLevel || !portability) return 0;

            return (setupScores[setupTime] * 0.22) + 
                   (skillScores[skillLevel] * 0.50) + 
                   (portabilityScores[portability] * 0.28);
        }

        function calculateTimeScore() {
            const disTime = parseFloat(document.getElementById('disassemblyTime').value) || 0;
            const reassTime = parseFloat(document.getElementById('reassemblyTime').value) || 0;
            const totalTime = disTime + reassTime;

            if (totalTime <= 120) return 1;
            if (totalTime <= 240) return 2 - (totalTime / 120);
            return 0;
        }

        function calculateStepsScore() {
            const steps = parseFloat(document.getElementById('numberOfSteps').value) || 0;

            if (steps <= 15) return 1;
            if (steps < 60) return (60 - steps) / 45;
            return 0;
        }

        function calculateToleranceScore() {
            const tolerance = parseFloat(document.getElementById('tolerance').value) || 0;

            if (tolerance < 10) return 0;
            if (tolerance <= 50) return (tolerance - 10) / 40;
            return 1;
        }

        function calculateSizeScore() {
            const jointArea = calculateJointArea();

            if (jointArea <= 600) return 1;
            if (jointArea < 2500) return (2500 - jointArea) / 1900;
            return 0;
        }

        function calculateAccessibilityScore() {
            const accessibility = document.getElementById('accessibility').value;
            
            const accessibilityScores = {
                'accessible-dfd': 1,
                'partially-accessible-dfd': 0.75,
                'non-accessible-dfd': 0.5,
                'partially-accessible-standard': 0.25,
                'non-accessible-standard': 0
            };

            return accessibilityScores[accessibility] || 0;
        }

        function calculatePrefabScore() {
            const prefabArea = parseFloat(document.getElementById('prefabArea').value) || 0;
            const jointArea = calculateJointArea();

            if (jointArea === 0) return 0;
            return Math.min(1, prefabArea / jointArea);
        }

        document.getElementById('assessmentForm').addEventListener('submit', function(e) {
            e.preventDefault();

            // Calculate individual parameter scores
            const scores = {
                endOfCycleWaste: calculateEndOfCycleWaste(),
                damageProb: calculateDamageProb(),
                easeDisassembly: calculateEaseScore(),
                easeReassembly: calculateEaseScore(), // Same calculation, different tools in practice
                connectionComplexity: 0.5, // Simplified - would need more inputs for full calculation
                designDoc: 0.8, // Assumed value - would need document availability input
                stepsAndTime: (calculateStepsScore() * 0.5) + (calculateTimeScore() * 0.5),
                accessibility: calculateAccessibilityScore(),
                tolerance: calculateToleranceScore(),
                prefabDegree: calculatePrefabScore(),
                size: calculateSizeScore(),
                structuralStrength: 0.7 // Assumed value - would need structural analysis inputs
            };

            // Calculate weighted total score
            let totalWeightedScore = 0;
            let totalWeight = 0;

            for (const [param, score] of Object.entries(scores)) {
                const weight = weights[param];
                totalWeightedScore += score * weight;
                totalWeight += weight;
            }

            const finalScore = totalWeightedScore / totalWeight;

            // Display results
            displayResults(finalScore, scores);
        });

        function displayResults(finalScore, scores) {
            const resultsDiv = document.getElementById('results');
            const totalScoreDiv = document.getElementById('totalScore');
            const parameterResultsDiv = document.getElementById('parameterResults');

            // Show results
            resultsDiv.classList.remove('hidden');

            // Display total score
            const percentage = (finalScore * 100).toFixed(1);
            const rating = getRating(finalScore);
            totalScoreDiv.innerHTML = `
                Overall Reusability Score: <span style="color: ${getRatingColor(finalScore)}">${percentage}%</span>
                <br><small>${rating}</small>
            `;

            // Display parameter scores
            parameterResultsDiv.innerHTML = '';
            for (const [param, score] of Object.entries(scores)) {
                const paramDiv = document.createElement('div');
                paramDiv.className = 'parameter-result';
                paramDiv.innerHTML = `
                    <strong>${getParameterName(param)}</strong><br>
                    Score: ${(score * 100).toFixed(1)}%<br>
                    Weight: ${weights[param].toFixed(2)}
                `;
                parameterResultsDiv.appendChild(paramDiv);
            }

            // Scroll to results
            resultsDiv.scrollIntoView({ behavior: 'smooth' });
        }

        function getRating(score) {
            if (score >= 0.75) return "🟢 Excellent Reusability Potential";
            if (score >= 0.5) return "🟡 Good Reusability Potential";
            if (score >= 0.25) return "🟠 Moderate Reusability Potential";
            return "🔴 Poor Reusability Potential";
        }

        function getRatingColor(score) {
            if (score >= 0.75) return "#4CAF50";
            if (score >= 0.5) return "#FF9800";
            if (score >= 0.25) return "#FF5722";
            return "#F44336";
        }

        function getParameterName(param) {
            const names = {
                endOfCycleWaste: "End of Cycle Waste",
                damageProb: "Damage Probability",
                easeDisassembly: "Ease of Disassembly",
                easeReassembly: "Ease of Reassembly",
                connectionComplexity: "Connection Complexity",
                designDoc: "Design Documentation",
                stepsAndTime: "Steps and Time",
                accessibility: "Accessibility",
                tolerance: "Tolerance",
                prefabDegree: "Prefabrication Degree",
                size: "Size",
                structuralStrength: "Structural Strength"
            };
            return names[param] || param;
        }

        // Auto-calculate joint area when inputs change
        ['connectionType', 'length', 'width', 'height'].forEach(id => {
            document.getElementById(id).addEventListener('input', function() {
                const jointArea = calculateJointArea();
                if (jointArea > 0) {
                    console.log(`Joint Area: ${jointArea.toFixed(2)} cm²`);
                }
            });
        });
    </script>
</body>
</html>
